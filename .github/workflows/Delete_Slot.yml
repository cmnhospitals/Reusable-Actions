name: "ğŸš€ Deploy"

on:
    workflow_call:
        inputs:
            octopus_project_name:
                description: 'The Octopus Deploy project name passed from the caller workflow.'
                required: true
                type: string

defaults:
    run:
        shell: pwsh

env:
    OCTOPUS_API_KEY: ${{ secrets.OCTOPUS_API_KEY }}
    OCTOPUS_URL: ${{ secrets.OCTOPUS_SERVER_URL }}
    GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  
jobs:
  Env:
    name: ğŸ’ Environment Variables
    runs-on: self-hosted
    steps:
    - name: Print Environment Variables
      run: "gci env:"
  Delete_Slot:
    name: â˜ ï¸ Delete Slot
    runs-on: self-hosted
    steps:
    - name: ğŸšš Get Latest Code
      uses: actions/checkout@v3
      with:
        fetch-depth: "0"
    # - name: Install Octopus CLI ğŸ™
    #   uses: OctopusDeploy/install-octopus-cli-action@v3
    #   with:
    #     version: latest
    - name: ğŸ™ Run Runbook to Delete Deployment Slot
      uses: OctopusDeploy/run-runbook-action@v3
      with:
        project: '${{ inputs.octopus_project_name }}'
        runbook: 'Remove A Deployment Slot'
        environments: |
            Azure - Dev
            Azure - Test
        variables: |
            SlotName:${{ github.event.pull_request.number }}-pr
        space: Web
        server: ${{ env.OCTOPUS_URL }}
        api_key: ${{ env.OCTOPUS_API_KEY }}
